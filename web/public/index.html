<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QZSS Power Control</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
        }

        .switch-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px auto;
            max-width: 350px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn {
            background-color: #ccc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-left: 5px;
            transition: background-color 0.2s;
        }

        .btn:active {
            opacity: 0.8;
        }

        /* Active States */
        .btn-on.active {
            background-color: #28a745;
            opacity: 1;
        }

        .btn-off.active {
            background-color: #dc3545;
            opacity: 1;
        }

        /* Inactive States */
        .btn-on {
            opacity: 0.3;
            background-color: #28a745;
        }

        .btn-off {
            opacity: 0.3;
            background-color: #dc3545;
        }

        h1 {
            color: #333;
        }

        #connection-status {
            font-size: 12px;
            color: #666;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <h1>ÈõªÊ∫ê„Çø„ÉÉ„ÉóÊìç‰Ωú</h1>
    <div id="connection-status">Connecting...</div>

    <div id="relays">
        <!-- Generated by JS or Hardcoded -->
        <div class="switch-container">
            <span>„Ç≥„É≥„Çª„É≥„Éà 1</span>
            <div>
                <button id="r1-on" class="btn btn-on" onclick="control(1, true)">ON</button>
                <button id="r1-off" class="btn btn-off" onclick="control(1, false)">OFF</button>
            </div>
        </div>
        <div class="switch-container">
            <span>„Ç≥„É≥„Çª„É≥„Éà 2</span>
            <div>
                <button id="r2-on" class="btn btn-on" onclick="control(2, true)">ON</button>
                <button id="r2-off" class="btn btn-off" onclick="control(2, false)">OFF</button>
            </div>
        </div>
        <div class="switch-container">
            <span>„Ç≥„É≥„Çª„É≥„Éà 3</span>
            <div>
                <button id="r3-on" class="btn btn-on" onclick="control(3, true)">ON</button>
                <button id="r3-off" class="btn btn-off" onclick="control(3, false)">OFF</button>
            </div>
        </div>
        <div class="switch-container">
            <span>„Ç≥„É≥„Çª„É≥„Éà 4</span>
            <div>
                <button id="r4-on" class="btn btn-on" onclick="control(4, true)">ON</button>
                <button id="r4-off" class="btn btn-off" onclick="control(4, false)">OFF</button>
            </div>
        </div>
    </div>

    <hr style="margin: 30px 0; border: none; border-top: 1px solid #ddd;">

    <div id="debug-panel" style="background: #eef; padding: 20px; border-radius: 10px;">
        <h2>üõ† Debugger Control</h2>
        <div style="margin-bottom: 20px;">
            <h3>Simulate Buttons</h3>
            <button class="btn" onclick="simButton(1)" style="background: #555;">Button 1 (Reset)</button>
            <button class="btn" onclick="simButton(2)" style="background: #555;">Btn 2 (R1)</button>
            <button class="btn" onclick="simButton(3)" style="background: #555;">Btn 3 (R2)</button>
            <button class="btn" onclick="simButton(4)" style="background: #555;">Btn 4 (R3)</button>
            <button class="btn" onclick="simButton(5)" style="background: #f0ad4e;">Btn 5 (Test Alert)</button>
        </div>

        <div>
            <h3>Simulate Disaster</h3>
            <button class="btn" onclick="simQZSS()" style="background: #d9534f;">Earthquake (QZSS)</button>
            <button class="btn" onclick="simIMU()" style="background: #d9534f;">Shake (IMU)</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const statusEl = document.getElementById('connection-status');

        socket.on('connect', () => {
            statusEl.innerText = 'Connected via Socket.IO';
            statusEl.style.color = 'green';
            // Request initial status
            socket.emit('c2s_control', { cmd: 'get' });
        });

        socket.on('disconnect', () => {
            statusEl.innerText = 'Disconnected';
            statusEl.style.color = 'red';
        });

        socket.on('s2c_status', (data) => {
            console.log('Status Update:', data);
            updateUI(data);
        });

        function control(relayId, state) {
            console.log(`Sending Set Relay ${relayId} to ${state}`);
            socket.emit('c2s_control', { cmd: 'set', relay: relayId, state: state });
        }

        // Debug Functions
        function simButton(id) {
            console.log('Simulating Button', id);
            socket.emit('c2s_control', { cmd: 'simulate_button', btn_id: id });
        }

        function simQZSS() {
            const report = "Simulated QZSS Alert: Earthquake Major Warning";
            console.log('Simulating QZSS');
            socket.emit('c2s_control', { cmd: 'simulate_qzss', report: report });
        }

        function simIMU() {
            console.log('Simulating IMU');
            socket.emit('c2s_control', { cmd: 'simulate_imu', force: 2.5 });
        }

        function updateUI(status) {
            // status = { "1": true, "2": false ... }
            for (const [id, isOn] of Object.entries(status)) {
                const btnOn = document.getElementById(`r${id}-on`);
                const btnOff = document.getElementById(`r${id}-off`);

                if (btnOn && btnOff) {
                    if (isOn) {
                        btnOn.classList.add('active');
                        btnOff.classList.remove('active');
                    } else {
                        btnOn.classList.remove('active');
                        btnOff.classList.add('active');
                    }
                }
            }
        }
    </script>
</body>

</html>